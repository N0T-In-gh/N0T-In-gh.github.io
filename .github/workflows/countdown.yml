name: Daily Countdown

on:
  schedule:
    - cron: "52 14 * * *"
  workflow_dispatch:

jobs:
  send_countdown:
    runs-on: ubuntu-latest
    steps:
      - name: Send countdown (JST)
        run: |
          TZ='Asia/Tokyo'

          TARGET="2026-02-03"

          NOW=$(TZ='Asia/Tokyo' date -d "8 minutes" +"%Y-%m-%d")

          TARGET_TS=$(TZ='Asia/Tokyo' date -d "$TARGET" +%s)
          NOW_TS=$(TZ='Asia/Tokyo' date -d "$NOW" +%s)

          DAYS_LEFT=$(( (TARGET_TS - NOW_TS) / 86400 ))
          if [ $DAYS_LEFT -lt 0 ]; then
            DAYS_LEFT=0
          fi

          CONTENT="${DAYS_LEFT}"

          curl -H "Content-Type: application/json" \
            -X POST \
            -d "{\"username\": \"Count down\", \"avatar_url\": \"https://n0t-in-gh.github.io/countdown.png\", \"content\": \"${CONTENT}\"}" \
            "${{ secrets.WEBHOOK }}"
